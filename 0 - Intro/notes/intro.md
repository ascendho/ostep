# intro

## 一、核心定位与核心问题
### 1. 操作系统核心定位
操作系统（OS）是计算机系统的核心软件，兼具三大角色：
- **资源管理器**：管理CPU、内存、磁盘等物理资源，实现高效共享与调度；
- **虚拟机器**：通过虚拟化技术将物理资源转化为通用、易用的虚拟形式，为程序提供“私有资源”的 illusion；
- **标准库/接口提供者**：暴露系统调用（API），支持程序运行、内存分配、设备访问等操作。

### 2. 三大核心问题（Crux）
- 如何**虚拟化资源**：将有限物理资源转化为多程序可共享的虚拟资源，兼顾效率与易用性？
- 如何**构建正确的并发程序**：当多线程共享内存时，如何避免数据竞争等问题，保证程序正确性？
- 如何**实现数据持久性**：在内存易失的情况下，如何通过软硬件协作，安全、高效地长期存储数据？

## 二、三大核心功能主题
### 1. 虚拟化（Virtualization）：资源的“分身术”
虚拟化是OS的核心技术，核心目标是让多个程序“看似同时”使用物理资源，本质是“ illusion 制造”。

#### （1）CPU虚拟化
- 核心逻辑：单CPU（或少量CPU）通过OS调度，快速切换多个程序执行，模拟“无限个虚拟CPU”；
- 示例验证：同时运行多个`cpu.c`程序（循环打印字符串），OS通过进程切换，让多个程序看似并行执行；
- 关键机制：OS负责进程的启动、暂停、切换，硬件提供特权级支持（如中断），确保调度可控。

#### （2）内存虚拟化
- 核心逻辑：每个程序拥有独立的**虚拟地址空间**，OS将其映射到物理内存，实现“私有内存”的错觉；
- 示例验证：同时运行多个`mem.c`程序，均分配到相同虚拟地址（如0x200000），但各自修改的值独立，互不干扰；
- 关键价值：隔离程序内存访问，避免一个程序的错误操作影响其他程序或OS。

### 2. 并发（Concurrency）：多任务的“协同术”
并发聚焦“多任务同时执行”的问题，核心挑战是多线程共享内存时的正确性。

- 核心问题：多线程操作共享数据时，因指令非原子性（如`counter++`需加载、递增、存储三步），导致结果不一致；
- 示例验证：`threads.c`中两个线程各递增计数器100000次，最终结果小于200000，且每次运行结果不同；
- 解决方向：OS提供同步原语（锁、信号量等），硬件提供原子指令支持，确保共享数据操作的完整性。

### 3. 持久性（Persistence）：数据的“保鲜术”
持久性解决内存易失的问题，通过I/O设备（磁盘、SSD）和文件系统，实现数据长期存储。

- 核心组件：文件系统是OS管理持久化的核心，负责磁盘空间分配、数据结构维护、读写调度；
- 示例验证：`io.c`通过`open()`创建文件、`write()`写入数据、`close()`关闭文件，文件系统确保数据存储在磁盘，断电后不丢失；
- 关键机制：为保证可靠性，文件系统采用日志（journaling）、写时复制（copy-on-write）等协议；为提升性能，采用延迟写入、批量处理等策略。

## 三、操作系统设计目标
OS设计需在多目标间权衡，核心目标包括：
1. **抽象易用**：提供简洁的资源抽象（如进程、文件），隐藏硬件细节，降低编程难度；
2. **高性能**：最小化OS自身开销（时间、空间），确保程序运行效率；
3. **保护与隔离**：隔离不同程序的资源访问，防止恶意或误操作影响其他程序或OS；
4. **高可靠性**：确保OS持续运行，即使面临硬件故障或程序错误，也能恢复到稳定状态；
5. **拓展目标**：能效优化（适配移动设备）、安全防护（抵御恶意攻击）、移动性支持等。

## 四、操作系统发展历史
OS的演进是“功能迭代+问题解决”的过程，关键阶段如下：
1. **早期批处理系统（Just Libraries）**：OS仅为常用功能库，单程序运行，人工调度作业，无资源隔离；
2. **系统调用与保护机制**：引入“用户态/内核态”切换，通过陷阱（trap）指令触发系统调用，OS获得硬件特权级，实现资源保护；
3. **多道程序设计时代**：OS加载多个程序到内存，通过快速切换提升CPU利用率，UNIX系统成为标杆（简洁、可扩展、支持C语言编译）；
4. **现代OS时代**：PC普及（早期DOS、Mac OS缺乏隔离）→ Linux崛起（开源、兼容UNIX）→ 移动设备OS（Android基于Linux），重拾多道程序设计的核心特性（隔离、调度、虚拟内存）。

## 五、作业类型与实践要求
本书作业分为两类，旨在强化理论与实践结合：
1. **模拟类作业**：通过程序模拟系统行为（如磁盘调度、进程调度），探索不同机制的性能差异，无需依赖真实硬件；
2. **真实代码交互类作业**：基于UNIX/Linux系统，编写C语言程序、测量系统性能或修改系统组件，熟悉系统调用与底层机制；
- 实践环境要求：UNIX-based系统（Linux、macOS）、C编译器（gcc）、Python、代码编辑器。

## 六、核心总结
1. OS的本质是“抽象层+资源管理器”，通过虚拟化、并发控制、持久性三大核心功能，平衡易用性、效率与安全性；
2. 虚拟化是“ illusion 制造”，并发是“多任务协同”，持久性是“数据保鲜”，三者共同构成现代OS的基石；
3. OS的发展是“问题驱动”的迭代，从早期的“简化编程”到现代的“多目标权衡”，核心思想（隔离、调度、抽象）始终延续；
4. 实践是掌握OS的关键，通过模拟与真实代码实验，可深入理解底层机制的工作原理。
